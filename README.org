#+TITLE: Monero tools

This is a Common Lisp toolbox to work with the Monero cryptocurrency.

The *monero-tools* system contains basic tools that can be use offline. The
*monero-tools-rpc* system contains tools requiring a running *monerod* or/and
*monero-wallet-rpc* daemon to connect to.

* Installation

To load the *monero-tools* library, put it in a directory where your
Common Lisp implementation can see it, and use the usual:

#+BEGIN_SRC lisp
(asdf:load-system "monero-tools")
#+END_SRC

or

#+BEGIN_SRC lisp
(ql:quickload "monero-tools")
#+END_SRC

** *monero-tools* dependencies
*monero-tools* requires the following libraries:
 - alexandria
 - babel
 - bordeaux-threads
 - cffi
 - cl-json
 - cl-octet-streams
 - cl-ppcre
 - cl-qrencode
 - ieee-floats
 - ironclad
 - png-read
 - split-sequence

Optional:
 - the unbound C library (to resolve OpenAlias names)
 - the zbar C library (to read QR codes)

If the optional C libraries are not available, the system should load
successfully but some functions will not work.

** *monero-tools-rpc* dependencies

*monero-tools-rpc* requires the following libraries:
 - bordeaux-threads
 - cl-base64
 - cl-json
 - dexador
 - ironclad
 - monero-tools
 - pzmq
 - split-sequence

* Basic tools

After loading the *monero-tools* system, the following functions and variables
are in the *:monero-tools* package.

** Blockchain

 - acceptable-hash-p
 - compute-block-hash
 - compute-block-hash-from-data
 - compute-miner-transaction-hash
 - compute-miner-transaction-hash-from-data
 - compute-transaction-hash
 - compute-transaction-hash-from-data
 - compute-transaction-tree-hash

** Cryptography

 - =*cryptonight-variant*=
 - chacha8
 - chacha20
 - compute-key-image
 - derive-key
 - derive-output-public-key
 - derive-output-secret-key
 - derive-public-spend-subkey
 - derive-secret-spend-subkey
 - fast-hash
 - generate-chacha-key
 - generate-keys
 - generate-secret-key
 - generate-ring-signature
 - generate-signature
 - public-spend-subkey->public-view-subkey
 - recover-keys
 - secret-key->public-key
 - secret-spend-key->secret-view-key
 - slow-hash
 - tree-hash
 - valid-ring-signature-p
 - valid-signature-p

** Mining

 - miner
 - mining-profitability

** Mnemonic seed

 - available-mnemonic-seed-languages
 - decrypt-mnemonic-seed
 - encrypt-mnemonic-seed
 - mnemonic-seed->secret-key
 - secret-key->mnemonic-seed

** OpenAlias

 - =*dns-server*=
 - =*dnssec-trust-anchor*=
 - get-openalias-info

** Serialization

 - deserialize-block
 - deserialize-block-header
 - deserialize-from-binary-storage
 - deserialize-transaction
 - deserialize-transaction-prefix
 - serialize-block
 - serialize-block-header
 - serialize-to-binary-storage
 - serialize-transaction
 - serialize-transaction-prefix

** Utils

 - base58-decode
 - base58-encode
 - bytes->hex-string
 - bytes->integer
 - bytes->string
 - bytes->utf-8-string
 - format-float
 - geta
 - hex-string->bytes
 - integer->bytes
 - read-float
 - string->bytes
 - utf-8-string->bytes

** Wallet

 - =+monero-unit+=
 - bruteforce-wallet-keys
 - decode-address
 - decode-qr-code
 - decode-uri
 - decrypt-amount
 - decrypt-payment-id
 - encrypt-payment-id
 - get-wallet-keys
 - make-integrated-address
 - make-qr-code
 - make-uri
 - output-for-address-p
 - prove-inbound-transaction
 - prove-outbound-transaction
 - prove-payment
 - public-keys->address
 - public-keys->subaddress
 - received-amount
 - secret-spend-key->address
 - secret-spend-key->subaddress
 - sign-file
 - sign-message
 - spent-key-images
 - valid-file-signature-p
 - valid-inbound-transaction-proof-p
 - valid-message-signature-p
 - valid-outbound-transaction-proof-p
 - valid-payment-proof-p

* RPC tools

After loading the *monero-tools-rpc* system, the following functions and
variables are in the *:monero-tools-rpc* package.

** Remote procedure call

 - =*rpc-host*=
 - =*rpc-password*=
 - =*rpc-port*=
 - =*rpc-user*=
 - json-rpc
 - rpc
 - zmq-json-rpc

** Mining

 - mine-block

** Wallet

 - transaction-history

** Calling *monerod*
*** HTTP JSON RPCs

The following functions are thin wrappers for the HTTP JSON RPCs of *monerod*.
They use alists instead of JSON objects, where a key named =some_key= in a JSON
object becomes =:some-key= in the alist. The specifications of these RPCs can be
found in https://getmonero.org/resources/developer-guides/daemon-rpc.html.

 - flush-txpool
 - get-alternate-chain
 - get-bans
 - get-block
 - get-block-count
 - get-block-hash
 - get-block-header-by-hash
 - get-block-header-by-height
 - get-block-headers-range
 - get-block-template
 - get-coinbase-tx-sum
 - get-connections
 - get-fee-estimate
 - get-info
 - get-last-block-header
 - get-output-distribution
 - get-output-histogram
 - get-txpool-backlog
 - get-version
 - hard-fork-info
 - relay-tx
 - set-bans
 - submit-block
 - sync-info

*** Other HTTP RPCs
*** ZeroMQ RPCs
** Calling *monero-wallet-rpc*

TODO
There are some examples in src/rpc/wallet.lisp.


* Tests

The tests require the *fiveam* library.

#+BEGIN_SRC lisp
(asdf:test-system "monero-tools")
#+END_SRC
